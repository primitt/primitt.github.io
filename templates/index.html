<html data-theme="black" lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.7/dist/full.min.css" rel="stylesheet" type="text/css" />
  <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
    integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous" />
  <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
    crossorigin="anonymous"></script>
  <script src="./scripts/particles.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Mapbox GL JS -->
  <script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
  <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />
  <meta charset="UTF-8" />
  <meta name="google" content="notranslate" />
  <meta http-equiv="Content-Language" content="en" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>ayonull</title>
  <!-- add meta tags for discord -->
  <meta name="description" content="Primitt/ayonull's profile. Projects, blogs, experience & more." />
  <meta property="og:title" content="ayonull" />
  <meta property="og:description" content="Primitt/ayonull's profile. Projects, blogs, experience & more." />
  <meta content="#858585" name="theme-color" />
</head>
<style>
  .typing::after {
    content: "|";
    animation: blink 1s infinite;
    margin-left: 3px;
    display: inline-block;
  }

  @keyframes blink {
    50% {
      opacity: 0;
    }
  }

  .background {
    position: absolute;
    width: 100%;
    height: 100%;
    z-index: -1;
  }

  /* Windows-style window controls */
  .window-control {
    transition: all 0.1s ease;
  }

  .window-control:hover {
    transform: scale(1.05);
  }

  /* Simplified card hover effects */
  .card:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  }

  /* Custom scrollbar for Windows feel */
  .overflow-auto::-webkit-scrollbar {
    width: 12px;
  }

  .overflow-auto::-webkit-scrollbar-track {
    background: #1f2937;
    border-radius: 6px;
  }

  .overflow-auto::-webkit-scrollbar-thumb {
    background: #4b5563;
    border-radius: 6px;
    border: 2px solid #1f2937;
  }

  .overflow-auto::-webkit-scrollbar-thumb:hover {
    background: #6b7280;
  }

  /* Line clamp utility */
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* Hide Mapbox attribution */
  .mapboxgl-ctrl-attrib,
  .mapboxgl-ctrl-logo {
    display: none !important;
  }
</style>

<body>
  <div id="particles-js" class="background"></div>
  
  <!-- Top Profile Section (full screen) -->
  <div class="container mx-auto px-4 pb-8 max-w-7xl">
    <div class="h-[92vh] flex items-center justify-center relative mt-8 mb-5">
    <div class="card bg-base-200 absolute inset-0 flex flex-col justify-center items-center text-center px-4 pb-8">
      <!-- Main content centered -->
      <div class="flex-1 flex flex-col justify-center items-center max-w-4xl">
        <p class="text-lg mb-4 text-gray-300">Hi! I am</p>
        <div class="flex items-center justify-center gap-3 mb-6">
          <h1 class="text-6xl md:text-8xl font-bold">
            <span id="usernames" class="typing"></span>
          </h1>
          <img src="./images/1f1fa-1f1f8.svg" width="50px" class="ml-2" />
        </div>
        
        <!-- Social links centered under name -->
        <div class="flex gap-6 text-3xl mb-8">
          <a href="https://github.com/primitt" class="text-gray-300 hover:text-white transition-colors">
            <i class="fab fa-github"></i>
          </a>
          <a href="https://twitter.com/primitt" class="text-gray-300 hover:text-white transition-colors">
            <i class="fab fa-twitter"></i>
          </a>
          <a href="https://www.linkedin.com/in/primitt/" class="text-gray-300 hover:text-white transition-colors">
            <i class="fab fa-linkedin"></i>
          </a>
          <a href="https://anilist.co/user/pma" class="text-gray-300 hover:text-white transition-colors">
            <img src="./images/anilist.svg" width="28px" />
          </a>
        </div>
      </div>
      
      <!-- Description at bottom -->
      <div class="absolute bottom-20 left-1/2 transform -translate-x-1/2 max-w-full md:max-w-2xl md:px-4">
        <p class="text-gray-300 md:text-lg leading-relaxed text-center">
          Motivated and dedicated high school student, highly driven to research, learn, and apply new and advanced
          technologies to solve problems and build applications, looking to learn, grow and make a positive social
          impact with technology.
        </p>
      </div>
      <p class="text-gray-500 mt-2">Scroll down to explore my projects, blogs, and more!</p>
    </div>
  </div>
    <!-- 3 columns layout - responsive grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-5 mb-5">
      <!-- First Column -->
      <div class="flex flex-col gap-5">
        <div class="card w-full bg-base-200 shadow-xl" id="languagespage">
          <div class="card-body">
            <div class="card-title text-2xl font-bold">
              <p>Languages</p>
            </div>
            <div>
              <p style="margin-bottom: 5px">Python</p>
              <progress class="progress w-full" value="90" max="100"></progress>
              <p style="margin-bottom: 5px">JS/TS</p>
              <progress class="progress w-full" value="85" max="100"></progress>
              <p style="margin-bottom: 5px">Java</p>
              <progress class="progress w-full" value="70" max="100"></progress>
              <p style="margin-bottom: 5px">C++</p>
              <progress class="progress w-full" value="60" max="100"></progress>
              <p style="margin-bottom: 5px">HTML/CSS</p>
              <progress class="progress w-full" value="60" max="100"></progress>
            </div>
          </div>
        </div>

        <div class="card w-full bg-base-200 shadow-xl" id="spotifypage">
          <div class="card-body">
            <div class="text-2xl">
              <p class="font-bold flex items-center gap-2">
                <i class="fab fa-spotify text-green-500"></i>
                Spotify
              </p>
              <p class="text-sm text-gray-500">Currently vibing to...</p>
            </div>

            <div id="spotify-content" class="mt-2">
              <div class="flex items-center space-x-3 p-3 bg-base-300 rounded-lg border border-gray-600">
                <div class="w-16 h-16 bg-gray-700 rounded-lg flex items-center justify-center" id="album-art">
                  <i class="fas fa-music text-gray-400 text-xl"></i>
                </div>
                <div class="flex-1 min-w-0">
                  <h3 class="font-semibold text-white truncate" id="track-name">Loading...</h3>
                  <p class="text-sm text-gray-400 truncate" id="artist-name">Getting your music...</p>
                  <p class="text-xs text-gray-500 truncate" id="album-name"></p>
                </div>
              </div>

              <div class="mt-3 text-center">
                <a href="#" id="spotify-link" class="text-green-400 hover:text-green-300 text-xs" target="_blank">
                  <i class="fab fa-spotify mr-1"></i>
                  Open in Spotify
                </a>
              </div>
            </div>

            <!-- Fallback when no music is playing -->
            <div id="spotify-fallback" class="hidden text-center py-6">
              <div class="text-4xl mb-3">üéµ</div>
              <p class="text-gray-400 italic">Nothing playing right now</p>
              <p class="text-xs text-gray-500 mt-1">Check back later!</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Second Column - Projects -->
      <div class="card w-full bg-base-200 shadow-xl" id="projectspage">
        <div class="card-body">
          <div class="text-2xl">
            <p class="font-bold">Projects</p>
            <p class="text-sm text-gray-500">Most recent projects shown... click "expand" to see them all</p>
          </div>

          {% for project in projects[:3] %}
          <div class="flex">
            <a class="bold font-bold">{{ project.name }}</a>&nbsp;-<span>
              &nbsp;{{ project.description }}
              <br /><span class="text-gray-500">{{ project.date }}
                {% if project.status == 1 %}
                <div class="badge badge-warning badge-soft">In Progress</div>
                {% elif project.status == 2 %}
                <div class="badge badge-success">Completed</div>
                {% elif project.status == 3 %}
                <div class="badge">Not Maintained</div>
                {% elif project.status == 4 %}
                <div class="badge badge-primary">Inactive</div>
                {% elif project.status == 5 %}
                <div class="badge badge-success badge-soft">Active</div>
                {% endif %}
              </span> </span><br />
          </div>
          {% endfor %}
        </div>

        <div class="card-actions justify-center p-4 border-t border-gray-600">
          <button id="expand-projects" class="btn btn-sm btn-outline" onclick="toggleProjectsExpand()">Expand</button>
        </div>
      </div>

      <!-- Third Column - Blog -->
      <div class="card w-full bg-base-200 shadow-xl" id="blogspage">
        <div class="card-body">
          <div class="text-2xl">
            <p class="font-bold">Blog</p>
            <p class="text-sm text-gray-500">Most recent posts... click "expand" to see them all</p>
          </div>

          {% if blogs %}
          {% for blog in blogs[:3] %}
          <div class="border-l-4 border-blue-500 pl-3 mb-3">
            <h3 class="font-semibold text-white">{{ blog.title }}</h3>
            {% if blog.content %}
            <p class="text-sm text-gray-400">{{ blog.content[:100] }}{% if blog.content|length > 100 %}...{% endif %}
            </p>
            {% endif %}
            <div class="flex items-center justify-between mt-2">
              <span class="text-xs text-gray-500">{{ blog.date }}</span>
              <a href="/blog/{{ blog.id }}" class="text-blue-400 hover:text-blue-300 text-xs">
                Read more <i class="fas fa-arrow-right"></i>
              </a>
            </div>
          </div>
          {% endfor %}
          {% else %}
          <div class="text-center py-8">
            <div class="text-6xl mb-4">ü¶ó</div>
            <p class="text-gray-400 italic">nothing here yet.... *crickets*</p>
          </div>
          {% endif %}
        </div>

        <div class="card-actions justify-center p-4 border-t border-gray-600">
          <button id="expand-blogs" class="btn btn-sm btn-outline" onclick="toggleBlogsExpand()">Expand</button>
        </div>
      </div>
    </div>

    <!-- Photography Section - Full width -->
    <div class="w-full">
      <div class="card w-full bg-base-200 shadow-xl" id="photographypage">
        <div class="card-body">
          <div class="text-2xl">
            <p class="font-bold">Photography</p>
            <p class="text-sm text-gray-500">Photos I have taken over the years</p>
          </div>
          <div class="text-center py-8">
            <div class="text-6xl mb-4">üì∏</div>
            <p class="text-gray-400 italic">coming soon...</p>
          </div>
        </div>
        <div class="hidden card-actions justify-center p-4 border-t border-gray-600">
          <button id="expand-photography" class="btn btn-sm btn-outline" onclick="togglePhotographyExpand()">Expand</button>
        </div>
      </div>
    </div>

    <!-- Recent Flights Section - Full width -->
    <div class="w-full mt-5">
      <div class="card w-full bg-base-200 shadow-xl" id="flightspage">
        <div class="card-body">
          <div class="text-2xl mb-4">
            <p class="font-bold flex items-center gap-2">
              <i class="fas fa-plane text-blue-500"></i>
              Recent Flights
            </p>
            <p class="text-sm text-gray-500">Where I've been flying recently</p>
          </div>
          
          <!-- Map container -->
          <div id="flights-map" class="w-full h-96 rounded-lg bg-gray-800 mb-4"></div>
          
          <!-- Flight stats -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div class="bg-base-300 rounded-lg p-4 text-center">
              <div class="text-2xl font-bold text-blue-400" id="total-flights">-</div>
              <div class="text-sm text-gray-400">Total Flights</div>
            </div>
            <div class="bg-base-300 rounded-lg p-4 text-center">
              <div class="text-2xl font-bold text-purple-400" id="countries-visited">-</div>
              <div class="text-sm text-gray-400">Countries</div>
            </div>
          </div>

          <!-- Recent flights list -->
          <div id="recent-flights-list" class="space-y-2">
            <div class="text-center py-4">
              <i class="fas fa-spinner fa-spin text-gray-400"></i>
              <p class="text-gray-400 mt-2">Loading flight data...</p>
            </div>
          </div>
        </div>
        
        <div class="card-actions justify-center p-4 border-t border-gray-600">
          <button id="expand-flights" class="btn btn-sm btn-outline" onclick="toggleFlightsExpand()">View All Flights</button>
        </div>
      </div>
    </div>
  </div>
  <div id="blogspage-expanded" class="hidden fixed inset-0 z-50 bg-black/80 backdrop-blur-sm">
    <div class="w-full h-full bg-base-200 shadow-2xl border border-gray-600 flex flex-col">
      <!-- Windows-style title bar -->
      <div class="bg-base-300 border-b border-gray-600 px-4 py-2 flex items-center justify-between select-none">
        <div class="flex items-center gap-3">
          <span class="text-lg font-semibold text-white">All Blog Posts</span>
        </div>
        <div class="flex items-center gap-2">
          <button class="w-8 h-8 rounded hover:bg-red-600 hover:text-white flex items-center justify-center text-white"
            onclick="toggleBlogsExpand()">
            <i class="fas fa-times text-sm"></i>
          </button>
        </div>
      </div>

      <!-- Content area -->
      <div class="flex-1 overflow-auto p-6 bg-base-200">
        <div class="max-w-4xl mx-auto">
          {% if blogs %}
          <div class="space-y-6">
            {% for blog in blogs %}
            <div
              class="card bg-base-300 shadow-lg border border-gray-600 hover:shadow-xl transition-shadow duration-200">
              <div class="card-body p-6 mb-4">
                <div class="flex items-start justify-between mb-4">
                  <div class="flex-1">
                    <h2 class="text-2xl font-bold text-white mb-2">{{ blog.title }}</h2>
                    {% if blog.hero_image %}
                    <div class="mb-4">
                      <img src="{{ blog.hero_image }}" alt="{{ blog.title }}"
                        class="w-full h-48 object-cover rounded-lg">
                    </div>
                    {% endif %}
                    {% if blog.content %}
                    <p class="text-gray-300 text-base leading-relaxed">
                      {{ blog.content[:300] }}{% if blog.content|length > 300 %}...{% endif %}
                    </p>
                    {% endif %}
                  </div>
                </div>

                <div class="flex items-center justify-between pt-4 border-t border-gray-600">
                  <div class="flex items-center gap-2 text-sm text-gray-400">
                    <i class="fas fa-calendar text-xs"></i>
                    <span>{{ blog.date }}</span>
                  </div>
                  <a href="/blog/{{ blog.id }}" class="btn btn-primary btn-sm">
                    <i class="fas fa-book-open mr-1"></i>
                    Read Full Post
                  </a>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div class="text-center py-20">
            <div class="text-8xl mb-6">ü¶ó</div>
            <h2 class="text-2xl font-bold text-white mb-2">Nothing here yet</h2>
            <p class="text-gray-400 italic text-lg">*crickets*</p>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Expanded full-projects panel (hidden by default) -->
  <div id="projectspage-expanded" class="hidden fixed inset-0 z-50 bg-black/80 backdrop-blur-sm">
    <div class="w-full h-full bg-base-200 shadow-2xl border border-gray-600 flex flex-col">
      <!-- Windows-style title bar -->
      <div class="bg-base-300 border-b border-gray-600 px-4 py-2 flex items-center justify-between select-none">
        <div class="flex items-center gap-3">
          <span class="text-lg font-semibold text-white">All Projects</span>
        </div>
        <div class="flex items-center gap-2">
          <button class="w-8 h-8 rounded hover:bg-red-600 hover:text-white flex items-center justify-center text-white"
            onclick="toggleProjectsExpand()">
            <i class="fas fa-times text-sm"></i>
          </button>
        </div>
      </div>

      <!-- Content area -->
      <div class="flex-1 overflow-auto p-6 bg-base-200">
        <div class="max-w-6xl mx-auto">
          <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-2">
            {% for project in projects %}
            <div
              class="card bg-base-300 shadow-lg border border-gray-600 hover:shadow-xl transition-shadow duration-200">
              <div class="card-body p-4">
                <div class="flex items-start justify-between mb-3">
                  <h3 class="font-bold text-lg text-white">{{ project.name }}</h3>
                  <div class="text-right text-xs text-gray-400">{{ project.date }}</div>
                </div>

                <p class="text-gray-300 text-sm mb-3">{{ project.description }}</p>

                <div class="flex items-center justify-between">
                  <div>
                    {% if project.status == 1 %}
                    <div class="badge badge-warning gap-1">
                      <i class="fas fa-clock text-xs"></i>
                      In Progress
                    </div>
                    {% elif project.status == 2 %}
                    <div class="badge badge-success gap-1">
                      <i class="fas fa-check text-xs"></i>
                      Completed
                    </div>
                    {% elif project.status == 3 %}
                    <div class="badge badge-ghost gap-1">
                      <i class="fas fa-archive text-xs"></i>
                      Not Maintained
                    </div>
                    {% elif project.status == 4 %}
                    <div class="badge badge-primary gap-1">
                      <i class="fas fa-pause text-xs"></i>
                      Inactive
                    </div>
                    {% elif project.status == 5 %}
                    <div class="badge badge-success badge-outline gap-1">
                      <i class="fas fa-play text-xs"></i>
                      Active
                    </div>
                    {% endif %}
                  </div>
                  {% if project.link %}
                  <a href="{{ project.link }}" target="_blank"
                    class="btn btn-ghost btn-xs text-gray-400 hover:text-white">
                    <i class="fas fa-external-link-alt"></i>
                  </a>
                  {% endif %}
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Expanded full-photography panel (hidden by default) -->
  <div id="photographypage-expanded" class="hidden fixed inset-0 z-50 bg-black/80 backdrop-blur-sm">
    <div class="w-full h-full bg-base-200 shadow-2xl border border-gray-600 flex flex-col">
      <!-- Windows-style title bar -->
      <div class="bg-base-300 border-b border-gray-600 px-4 py-2 flex items-center justify-between select-none">
        <div class="flex items-center gap-3">
          <span class="text-lg font-semibold text-white">All Photography</span>
        </div>
        <div class="flex items-center gap-2">
          <button class="w-8 h-8 rounded hover:bg-red-600 hover:text-white flex items-center justify-center text-white"
            onclick="togglePhotographyExpand()">
            <i class="fas fa-times text-sm"></i>
          </button>
        </div>
      </div>

      <!-- Content area -->
      <div class="flex-1 overflow-auto p-6 bg-base-200">
        <div class="max-w-6xl mx-auto">
          <div class="text-center py-20">
            <div class="text-8xl mb-6">üì∏</div>
            <h2 class="text-2xl font-bold text-white mb-2">Coming Soon</h2>
            <p class="text-gray-400 italic text-lg">Photography portfolio in development</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Expanded full-flights panel (hidden by default) -->
  <div id="flightspage-expanded" class="hidden fixed inset-0 z-50 bg-black/80 backdrop-blur-sm">
    <div class="w-full h-full bg-base-200 shadow-2xl border border-gray-600 flex flex-col">
      <!-- Windows-style title bar -->
      <div class="bg-base-300 border-b border-gray-600 px-4 py-2 flex items-center justify-between select-none">
        <div class="flex items-center gap-3">
          <span class="text-lg font-semibold text-white">All Flights</span>
        </div>
        <div class="flex items-center gap-2">
          <button class="w-8 h-8 rounded hover:bg-red-600 hover:text-white flex items-center justify-center text-white"
            onclick="toggleFlightsExpand()">
            <i class="fas fa-times text-sm"></i>
          </button>
        </div>
      </div>

      <!-- Content area -->
      <div class="flex-1 overflow-auto p-6 bg-base-200">
        <div class="max-w-6xl mx-auto">
          <!-- Full map for expanded view -->
          <div id="flights-map-expanded" class="w-full h-96 rounded-lg bg-gray-800 mb-6"></div>
          
          <!-- All flights list -->
          <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
            <div id="all-flights-list" class="col-span-full">
              <div class="text-center py-4">
                <i class="fas fa-spinner fa-spin text-gray-400"></i>
                <p class="text-gray-400 mt-2">Loading all flights...</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div>
  </div>

  <script>
    // Simplified toggle functions without animations
    function toggleProjectsExpand() {
      const expanded = document.getElementById('projectspage-expanded');
      const isHidden = expanded.classList.contains('hidden');

      if (isHidden) {
        expanded.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
      } else {
        expanded.classList.add('hidden');
        document.body.style.overflow = '';
      }
    }

    function toggleBlogsExpand() {
      const expanded = document.getElementById('blogspage-expanded');
      const isHidden = expanded.classList.contains('hidden');

      if (isHidden) {
        expanded.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
      } else {
        expanded.classList.add('hidden');
        document.body.style.overflow = '';
      }
    }

    function togglePhotographyExpand() {
      const expanded = document.getElementById('photographypage-expanded');
      const isHidden = expanded.classList.contains('hidden');

      if (isHidden) {
        expanded.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
      } else {
        expanded.classList.add('hidden');
        document.body.style.overflow = '';
      }
    }

    function toggleFlightsExpand() {
      const expanded = document.getElementById('flightspage-expanded');
      const isHidden = expanded.classList.contains('hidden');

      if (isHidden) {
        expanded.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
        // Initialize expanded map if not already done
        if (!window.expandedFlightsMap) {
          initializeExpandedFlightsMap();
        }
        // Populate all flights list
        populateAllFlightsList();
      } else {
        expanded.classList.add('hidden');
        document.body.style.overflow = '';
      }
    }
  </script>
</body>
<script>
  // This code is sadly not mine. I have no idea where I got this from (I got this from another project of mine), but it's not mine. So... credit to whoever made this, thank u, love u <3!
  const phrases = ["primitt", "ayonull"];
  let phraseIndex = 0;
  let charIndex = 0;
  const usernames = document.getElementById("usernames");

  function typePhrase() {
    if (charIndex < phrases[phraseIndex].length) {
      usernames.innerHTML += phrases[phraseIndex].charAt(charIndex);
      charIndex++;
      setTimeout(typePhrase, 100);
    } else {
      setTimeout(deletePhrase, 4000);
    }
  }

  function deletePhrase() {
    if (charIndex > 0) {
      usernames.innerHTML = usernames.innerHTML.slice(0, -1);
      charIndex--;
      setTimeout(deletePhrase, 100);
    } else {
      phraseIndex = (phraseIndex + 1) % phrases.length;
      setTimeout(typePhrase, 500);
    }
  }
  typePhrase();
  particlesJS.load("particles-js", "scripts/particles.json", function () {
    console.log("callback - particles.js config loaded");
  });
  // Spotify Integration
  function updateSpotifyStatus() {
    fetch('/api/spotify/current-track')
      .then(response => response.json())
      .then(data => {
        if (data.error) {
          showSpotifyFallback();
        } else if (data.is_playing && data.item) {
          updateSpotifyUI(data);
        } else {
          showSpotifyFallback();
        }
      })
      .catch(error => {
        console.error('Error fetching Spotify data:', error);
        showSpotifyFallback();
      });
  }

  function updateSpotifyUI(data) {
    document.getElementById('spotify-content').classList.remove('hidden');
    document.getElementById('spotify-fallback').classList.add('hidden');

    const track = data.item;
    const albumArt = document.getElementById('album-art');

    // Update track info
    document.getElementById('track-name').textContent = track.name;
    document.getElementById('artist-name').textContent = track.artists.map(a => a.name).join(', ');
    document.getElementById('album-name').textContent = track.album.name;
    document.getElementById('spotify-link').href = track.external_urls.spotify;

    // Update album art
    if (track.album.images && track.album.images.length > 0) {
      albumArt.innerHTML = `<img src="${track.album.images[0].url}" class="w-16 h-16 rounded-lg object-cover" alt="Album Art">`;
    }

  }

  function showSpotifyFallback() {
    document.getElementById('spotify-content').classList.add('hidden');
    document.getElementById('spotify-fallback').classList.remove('hidden');
  }

  function formatTime(ms) {
    const minutes = Math.floor(ms / 60000);
    const seconds = Math.floor((ms % 60000) / 1000);
    return `${minutes}:${seconds.toString().padStart(2, '0')}`;
  }

  // Initialize Spotify status
  updateSpotifyStatus();

  // Update every 30 seconds
  setInterval(updateSpotifyStatus, 30000);

  // Flights Integration
  let flightsData = [];
  let flightsMap = null;
  let expandedFlightsMap = null;
  let airportCoordinates = {};

  // Load airport coordinates from database
  function loadAirportDatabase() {
    return fetch('/scripts/airport_db.txt')
      .then(response => response.text())
      .then(data => {
        const lines = data.trim().split('\n');
        const coords = {};
        
        lines.forEach(line => {
          const parts = line.split(':');
          if (parts.length >= 16) {
            const iataCode = parts[1]; // IATA code is the second field
            const lat = parseFloat(parts[parts.length - 2]); // Second to last field
            const lng = parseFloat(parts[parts.length - 1]); // Last field
            
            // Only add if we have valid coordinates and IATA code
            if (iataCode && iataCode !== 'N/A' && !isNaN(lat) && !isNaN(lng) && lat !== 0 && lng !== 0) {
              coords[iataCode] = [lng, lat]; // [longitude, latitude] format for Mapbox
            }
          }
        });
        
        airportCoordinates = coords;
        console.log(`Loaded ${Object.keys(airportCoordinates).length} airports from database`);
        return coords;
      })
      .catch(error => {
        console.error('Error loading airport database:', error);
        // Fallback to hardcoded coordinates
        airportCoordinates = {
          'SJC': [-121.9289, 37.3626], // San Jose
          'SNA': [-117.8682, 33.6757], // John Wayne Orange County
          'LAX': [-118.4085, 33.9425], // Los Angeles
          'YYZ': [-79.6248, 43.6777], // Toronto Pearson
          'YUL': [-73.7408, 45.4706], // Montreal
          'OGG': [-156.4306, 20.8987], // Kahului
          'LHR': [-0.4614, 51.4700], // London Heathrow
          'NCE': [7.2658, 43.6584], // Nice
          'LGW': [-0.1902, 51.1481], // London Gatwick
          'ORD': [-87.9073, 41.9742], // Chicago O'Hare
          'BCN': [2.0833, 41.2974] // Barcelona
        };
        return airportCoordinates;
      });
  }

  function getAirportCode(airportString) {
    const match = airportString.match(/\(([A-Z]{3})\/[A-Z]{4}\)/);
    return match ? match[1] : null;
  }

  function parseCSV(csvText) {
    const lines = csvText.trim().split('\n');
    const headers = lines[0].split(',').map(h => h.replace(/"/g, ''));
    const data = [];

    for (let i = 1; i < lines.length; i++) {
      const values = lines[i].split(',');
      const row = {};
      headers.forEach((header, index) => {
        row[header] = values[index] ? values[index].replace(/"/g, '') : '';
      });
      data.push(row);
    }

    return data.sort((a, b) => new Date(b.Date) - new Date(a.Date));
  }

  function loadFlightsData() {
    // Load airport database first, then flight data
    loadAirportDatabase().then(() => {
      return fetch('/scripts/flight_info.csv');
    })
      .then(response => response.text())
      .then(csvText => {
        flightsData = parseCSV(csvText);
        updateFlightsUI();
        initializeFlightsMap();
      })
      .catch(error => {
        console.error('Error loading flights data:', error);
        document.getElementById('recent-flights-list').innerHTML = 
          '<div class="text-center py-4"><p class="text-red-400">Failed to load flight data</p></div>';
      });
  }

  function updateFlightsUI() {
    // Update stats
    document.getElementById('total-flights').textContent = flightsData.length;
    
    const countries = new Set();
    flightsData.forEach(flight => {
      // Simple country detection - you might want to make this more sophisticated
      const fromCode = getAirportCode(flight.From);
      const toCode = getAirportCode(flight.To);
      if (fromCode && fromCode.startsWith('Y')) countries.add('Canada');
      if (fromCode && ['LAX', 'SJC', 'SNA', 'ORD'].includes(fromCode)) countries.add('USA');
      if (fromCode && ['LHR', 'LGW'].includes(fromCode)) countries.add('UK');
      if (fromCode && fromCode === 'NCE') countries.add('France');
      if (fromCode && fromCode === 'BCN') countries.add('Spain');
      if (fromCode && fromCode === 'OGG') countries.add('USA');
    });
    
    document.getElementById('countries-visited').textContent = countries.size;

    // Show recent flights (last 5)
    const recentFlights = flightsData.slice(0, 5);
    const flightsList = document.getElementById('recent-flights-list');
    
    if (recentFlights.length === 0) {
      flightsList.innerHTML = '<div class="text-center py-4"><p class="text-gray-400">No flights found</p></div>';
      return;
    }

    flightsList.innerHTML = recentFlights.map(flight => {
      const fromCode = getAirportCode(flight.From);
      const toCode = getAirportCode(flight.To);
      const airline = flight.Airline.split('(')[0].trim();
      
      return `
        <div class="flex items-center justify-between p-3 bg-base-300 rounded-lg border border-gray-600">
          <div class="flex items-center space-x-3">
            <div class="text-2xl">‚úàÔ∏è</div>
            <div>
              <div class="font-semibold text-white">${fromCode} ‚Üí ${toCode}</div>
              <div class="text-sm text-gray-400">${airline} ‚Ä¢ ${flight['Flight number']}</div>
              <div class="text-xs text-gray-500">${flight.Date}</div>
            </div>
          </div>
          <div class="text-right">
            <div class="text-sm text-gray-300">${flight.Duration}</div>
            <div class="text-xs text-gray-500">${flight.Aircraft.split('(')[0].trim()}</div>
          </div>
        </div>
      `;
    }).join('');
  }

  function initializeFlightsMap() {
    mapboxgl.accessToken = 'pk.eyJ1IjoiYXlvbnVsbCIsImEiOiJjbWhpcnhvbmgweHA4MmxwdTFyMGJvY2hlIn0.3cNXJSBeHkJjj5X0YIR6xw';
    
    // Check if Mapbox GL JS is loaded
    if (typeof mapboxgl === 'undefined') {
      console.error('Mapbox GL JS not loaded');
      document.getElementById('flights-map').innerHTML = 
        '<div class="flex items-center justify-center h-full text-gray-400">' +
        '<div class="text-center">' +
        '<i class="fas fa-exclamation-triangle text-4xl mb-2"></i>' +
        '<p>Mapbox GL JS failed to load</p>' +
        '<p class="text-xs">Check your internet connection</p>' +
        '</div></div>';
      return;
    }

    try {
      console.log('Initializing Mapbox with token:', mapboxgl.accessToken.substring(0, 20) + '...');
      
      flightsMap = new mapboxgl.Map({
        container: 'flights-map',
        style: 'mapbox://styles/mapbox/dark-v11',
        center: [-98.5795, 39.8283], // Center of US
        zoom: 3
      });

      flightsMap.on('load', () => {
        console.log('Map loaded successfully');
        addFlightPaths(flightsMap);
      });

      flightsMap.on('error', (e) => {
        console.error('Map error:', e.error);
        document.getElementById('flights-map').innerHTML = 
          '<div class="flex items-center justify-center h-full text-gray-400">' +
          '<div class="text-center">' +
          '<i class="fas fa-exclamation-triangle text-4xl mb-2"></i>' +
          '<p>Map failed to load</p>' +
          '<p class="text-xs">' + e.error.message + '</p>' +
          '</div></div>';
      });

    } catch (error) {
      console.error('Mapbox initialization failed:', error);
      document.getElementById('flights-map').innerHTML = 
        '<div class="flex items-center justify-center h-full text-gray-400">' +
        '<div class="text-center">' +
        '<i class="fas fa-exclamation-triangle text-4xl mb-2"></i>' +
        '<p>Map initialization failed</p>' +
        '<p class="text-xs">' + error.message + '</p>' +
        '</div></div>';
    }
  }

  function initializeExpandedFlightsMap() {
    if (!mapboxgl.accessToken) {
      console.error('No Mapbox access token available for expanded map');
      return;
    }
    
    try {
      console.log('Initializing expanded map...');
      
      expandedFlightsMap = new mapboxgl.Map({
        container: 'flights-map-expanded',
        style: 'mapbox://styles/mapbox/dark-v11',
        center: [-98.5795, 39.8283],
        zoom: 2
      });

      expandedFlightsMap.on('load', () => {
        console.log('Expanded map loaded successfully');
        addFlightPaths(expandedFlightsMap);
      });

      expandedFlightsMap.on('error', (e) => {
        console.error('Expanded map error:', e.error);
      });

    } catch (error) {
      console.error('Expanded map initialization failed:', error);
    }
  }

  function addFlightPaths(map) {
    const features = [];
    const visitedAirports = new Set(); // Track airports actually visited
    
    flightsData.forEach((flight, index) => {
      const fromCode = getAirportCode(flight.From);
      const toCode = getAirportCode(flight.To);
      
      if (fromCode && toCode && airportCoordinates[fromCode] && airportCoordinates[toCode]) {
        // Track visited airports
        visitedAirports.add(fromCode);
        visitedAirports.add(toCode);
        
        // Add flight path
        features.push({
          type: 'Feature',
          properties: {
            flightNumber: flight['Flight number'],
            airline: flight.Airline.split('(')[0].trim(),
            date: flight.Date
          },
          geometry: {
            type: 'LineString',
            coordinates: [airportCoordinates[fromCode], airportCoordinates[toCode]]
          }
        });
      }
    });

    if (features.length > 0) {
      map.addSource('flights', {
        type: 'geojson',
        data: {
          type: 'FeatureCollection',
          features: features
        }
      });

      map.addLayer({
        id: 'flight-paths',
        type: 'line',
        source: 'flights',
        layout: {
          'line-join': 'round',
          'line-cap': 'round'
        },
        paint: {
          'line-color': '#3b82f6',
          'line-width': 2,
          'line-opacity': 0.7
        }
      });

      // Add airport markers ONLY for visited airports
      visitedAirports.forEach(code => {
        if (airportCoordinates[code]) {
          const marker = new mapboxgl.Marker({
            color: '#10b981'
          })
          .setLngLat(airportCoordinates[code])
          .setPopup(new mapboxgl.Popup().setHTML(`<strong>${code}</strong>`))
          .addTo(map);
        }
      });
    }
  }

  function populateAllFlightsList() {
    const allFlightsList = document.getElementById('all-flights-list');
    
    if (flightsData.length === 0) {
      allFlightsList.innerHTML = '<div class="text-center py-4"><p class="text-gray-400">No flights found</p></div>';
      return;
    }

    // Create a grid of all flights
    allFlightsList.innerHTML = `
      <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
        ${flightsData.map(flight => {
          const fromCode = getAirportCode(flight.From);
          const toCode = getAirportCode(flight.To);
          const airline = flight.Airline.split('(')[0].trim();
          const aircraft = flight.Aircraft.split('(')[0].trim();
          
          return `
            <div class="card bg-base-300 shadow-lg border border-gray-600 hover:shadow-xl transition-shadow duration-200">
              <div class="card-body p-4">
                <div class="flex items-start justify-between mb-3">
                  <h3 class="font-bold text-lg text-white">${fromCode} ‚Üí ${toCode}</h3>
                  <div class="text-right text-xs text-gray-400">${flight.Date}</div>
                </div>

                <div class="space-y-2 mb-3">
                  <div class="flex justify-between">
                    <span class="text-sm text-gray-400">Flight:</span>
                    <span class="text-sm text-white">${flight['Flight number']}</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-sm text-gray-400">Airline:</span>
                    <span class="text-sm text-white">${airline}</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-sm text-gray-400">Aircraft:</span>
                    <span class="text-sm text-white">${aircraft}</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-sm text-gray-400">Duration:</span>
                    <span class="text-sm text-white">${flight.Duration}</span>
                  </div>
                </div>

                <div class="flex items-center justify-between text-xs">
                  <div class="text-gray-500">
                    <i class="fas fa-plane-departure mr-1"></i>
                    ${flight['Dep time']}
                  </div>
                  <div class="text-gray-500">
                    <i class="fas fa-plane-arrival mr-1"></i>
                    ${flight['Arr time']}
                  </div>
                </div>
              </div>
            </div>
          `;
        }).join('')}
      </div>
    `;
  }

  // Initialize flights when page loads
  loadFlightsData();
</script>

</html>